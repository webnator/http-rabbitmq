language: node_js
services:
- docker
install:
- docker build -t rabbitmq ./images/RabbitMQ
- docker run -d --rm --env-file ./bin/.env -p 5779:5672 -p 15779:15672 --name rabbit-lib-test
  rabbitmq
- sleep 5
before_script:
- npm install -g npm@'>=2.13.5'
- npm i
script:
- npm run test
deploy:
  provider: npm
  email: webnator@gmail.com
  skip_cleanup: true
  api_key:
    secure: fifiMtJKsYPv43ynfS2mXgNoj4rFqRgp7ruWdEQxjr+Aj1v0AcgD9P/c0rlZtwIZymtYAKQokK3JOgOtYkrGM1i/IQLPww4F9/h8iogvOTbEfz/ytjMkTYFlDzeXlVwhVmQfo1a5CADkFchIme4ZPjjrlJ1LmFJE4dORf9IXQKgjfA8dQQNLYbxMq6le4+ssSdD+kBtkATvL3YUO7lI+2Bcb0PkLT5jwBbHsC8cdkDS9e9UWtmmOs56GqxEuYMYP9Jr/haTRKipet+HTtJqd+v5AZn4l5sqgi7MzibnXn+DF5MwtYWrMuw7tlrdRPTdNEuj0OftcIY3/S6fFnvLCAjuKuAdlL2cKBnsITa5tbjrdYqwVEgmlHj6VysjDz/Q0hE3/sdxteA2Nl5AtdJT52cSwFlzBCVAnVi0Hg3I9A0S7Ql7N6+SAEwNBRwpNdM1Z4FChSrbmZajtB0CYnbDdx7K0cA24Nb4jMee/d6Q9F0LZLiguXhlNgGltRUz6jW8hxYtPtKXNkEj6ttl/VdjJjgYeYKVLc5yVUYK2M/E/09FzwpjhnYj+ExGE53jJkCktBToHTpS5nQsZlZWwqfqJBgqDFG0dyO5UggxUqkRzvQ2qE/lfBwfK7ScJRRHYKp+is2obHidAFO0kdJc/Io/w5mlfgoIZB2cpbF9peyERbRc=
  on:
    tags: true
    repo: webnator/maestro-rabbit
